---
authors:
  - name: Ivan Diaz
    affiliation: NYU Population Health
    orcid: 0000-0001-9056-2047
    email: ivan.diaz@nyulangone.org
  - name: Nima Hejazi
    affiliation: Harvard Biostatistics
    orcid: 0000-0002-7127-2789
    email: nhejazi@hsph.harvard.edu
  - name: Kara Rudolph
    affiliation: Columbia Epidemiology
    orcid: 0000-0002-9417-7960
    email: kr2854@cumc.columbia.edu
---

```{r}
#| label: load-renv
#| echo: false
#| message: false
renv::load(here::here())
library(here)
```

# Welcome to SER 2024! {.unnumbered}

This open source, reproducible vignette accompanies a half-day workshop on
*modern causal mediation analysis*, presented at the SER 2024 annual meeting.
<!--
A version of this workshop was first taught at SER in 2021, and it has been
taught annually thereafter.
-->

## About this workshop {#about}

Causal mediation analysis can provide a mechanistic understanding of how an
exposure impacts an outcome, a central goal in epidemiology and health sciences.
However, rapid methodologic developments coupled with few formal courses
presents challenges to implementation. Beginning with an overview of classical
direct and indirect effects, this workshop will present recent advances that
overcome limitations of previous methods, allowing for: (i) continuous
exposures, (ii) multiple, non-independent mediators, and (iii) effects
identifiable in the presence of intermediate confounders affected by exposure.
Emphasis will be placed on flexible, stochastic and interventional direct and
indirect effects, highlighting how these may be applied to answer substantive
epidemiological questions from real-world studies. Multiply robust,
nonparametric estimators of these causal effects, and free and open source `R`
packages ([`medshift`](https://github.com/nhejazi/medshift) and
[`medoutcon`](https://github.com/nhejazi/medoutcon)) for their application, will
be introduced.

To ensure translation to real-world data analysis, this workshop will
incorporate hands-on `R` programming exercises to allow participants practice in
implementing the statistical tools presented. It is recommended that
participants have working knowledge of the basic notions of causal inference,
including counterfactuals and identification (linking the causal effect to a
parameter estimable from the observed data distribution). Familiarity with the
`R` programming language is also recommended.

## Tentative schedule {#schedule}

* 08:30A-08:45A: Introductions + mediation set-up
  <!-- Kara, 15 min-->
* 08:45A-9:15A: Controlled direct effects, natural direct/indirect effects,
  interventional direct/indirect effects
  <!-- Kara, 30-->
<!-- * 10:00A-10:20A: Stochastic mediation estimands -->
  <!-- Nima, 15-->
* 9:15A-9:25A: Choosing an estimand in real-world examples
  <!-- Kara, 10-->
* 9:25A-10:00A: What is the EIF?!
  <!-- Ivan, 35-->
* 10:00A-10:30A: Break + discussion
* 10:30A-11:05A: Using the EIF for estimating the natural direct effect
  <!-- Ivan, 35-->
* 11:05A-12:00P: Example walkthrough with `R` packages for effect estimation
  <!-- Nima, 55-->
* 12:00A-12:30P: Wrap-up

__NOTE: All times listed in Pacific Time.__

## About the instructors {#instructors}

### [Iván Díaz](https://www.idiaz.xyz/) {.unnumbered}

I am an Associate Professor of Biostatistics in the [Department of Population
Health at the NYU Grossman School of
Medicine](https://med.nyu.edu/faculty/ivan-l-diaz). My research focuses on the
development of non-parametric statistical methods for causal inference from
observational and randomized studies with complex datasets, using machine
learning. This includes but is not limited to mediation analysis, methods for
continuous exposures, longitudinal data including survival analysis, and
efficiency guarantees with covariate adjustment in randomized trials. I am also
interested in general semi-parametric theory, machine learning, and
high-dimensional data.


### [Nima Hejazi](https://nimahejazi.org) {.unnumbered}

I'm an Assistant Professor of Biostatistics at the [Harvard T.H. Chan School of
Public Health](https://www.hsph.harvard.edu/profile/nima-s-hejazi/).
My research explores how advances in causal inference, statistical machine
learning, and computational statistics can empower discovery in the biomedical
and health sciences. I focus on developing model-agnostic or assumption-lean
statistical inference techniques, emphasizing a science-first, translational
perspective to methodological research. Areas of recent emphasis have included
causal mediation analysis, inference under outcome-dependent sampling, causal
inference for continuous exposures, and sieve methods in causal machine
learning. My methodological work is usually motivated by scientific problems
from clinical trials and observational studies of infectious diseases, though
I've also explored topics ranging from environmental health to healthcare
equity. I'm also passionate about open source software, reproducible and
transparent data science, and high-performance computing.


### [Kara Rudolph](https://kararudolph.github.io/) {.unnumbered}

I am an Assistant Professor of Epidemiology in the [Columbia Mailman School of
Public Health](https://www.publichealth.columbia.edu/profile/kara-rudolph-phd).
My research interests are in developing and applying causal inference methods to
understand social and contextual influences on mental health, substance use, and
violence in disadvantaged, urban areas of the United States. My current work
focuses on developing methods for transportability and mediation, and
subsequently applying those methods to understand how aspects of the school and
peer environments mediate relationships between neighborhood factors and
adolescent drug use across populations. More generally, my work on
generalizing/transporting findings from study samples to target populations and
identifying subpopulations most likely to benefit from interventions contributes
to efforts to optimally target available policy and program resources.

## Reproducibility note {#repro}

These workshop materials were written using the [Quarto](https://quarto.org/),
an open-source, cross-platform technical publishing system built on
[RMarkdown](https://rmarkdown.rstudio.com/),
and the complete source is available on
[GitHub](https://github.com/nhejazi/causal_mediation_workshops). This version of
the book was built with `r R.version.string`, [pandoc](https://pandoc.org/)
version `r rmarkdown::pandoc_version()`, and [quarto](https://quarto.org/)
version `r quarto::quarto_version()`. See the [`renv.lock`
file](https://github.com/nhejazi/ser2024_mediation_workshop/blob/master/renv.lock)
in the source repository for an up-to-date list of the packages used.

## Setup instructions {#setup}

### R and RStudio

**R** and **RStudio** are separate downloads and installations. R is the
underlying statistical computing environment. RStudio is a graphical integrated
development environment (IDE) that makes using R much easier and more
interactive. You need to install R before you install RStudio.

#### Windows

##### If you already have R and RStudio installed

* Open RStudio, and click on "Help" > "Check for updates". If a new version is
  available, quit RStudio, and download the latest version for RStudio.
* To check which version of R you are using, start RStudio and the first thing
  that appears in the console indicates the version of R you are
  running. Alternatively, you can type `sessionInfo()`, which will also display
  which version of R you are running. Go on the [CRAN
  website](https://cran.r-project.org/bin/windows/base/) and check whether a
  more recent version is available. If so, please download and install it. You
  can [check here](https://cran.r-project.org/bin/windows/base/rw-FAQ.html#How-do-I-UNinstall-R_003f)
  for more information on how to remove old versions from your system if you
  wish to do so.

##### If you don't have R and RStudio installed

* Download R from
  the [CRAN website](http://cran.r-project.org/bin/windows/base/release.htm).
* Run the `.exe` file that was just downloaded
* Go to the [RStudio download
  page](https://www.rstudio.com/products/rstudio/download/#download)
* Under *Installers* select **RStudio x.yy.zzz - Windows
  XP/Vista/7/8** (where x, y, and z represent version numbers)
* Double click the file to install it
* Once it's installed, open RStudio to make sure it works and you don't get any
  error messages.

#### Mac OSX

##### If you already have R and RStudio installed

* Open RStudio, and click on "Help" > "Check for updates". If a new version is
  available, quit RStudio, and download the latest version for RStudio.
* To check the version of R you are using, start RStudio and the first thing
  that appears on the terminal indicates the version of R you are running.
  Alternatively, you can type `sessionInfo()`, which will also display which
  version of R you are running. Go on the [CRAN
  website](https://cran.r-project.org/bin/macosx/) and check whether a more
  recent version is available. If so, please download and install it.

##### If you don't have R and RStudio installed

* Download R from the [CRAN website](http://cran.r-project.org/bin/macosx).
* Select the `.pkg` file for the latest R version
* Double click on the downloaded file to install R
* It is also a good idea to install [XQuartz](https://www.xquartz.org/) (needed
  by some packages)
* Go to the [RStudio download
  page](https://www.rstudio.com/products/rstudio/download/#download)
* Under *Installers* select **RStudio x.yy.zzz - Mac OS X 10.6+ (64-bit)**
  (where x, y, and z represent version numbers)
* Double click the file to install RStudio
* Once it's installed, open RStudio to make sure it works and you don't get any
  error messages.

#### Linux

* Follow the instructions for your distribution from
  [CRAN](https://cloud.r-project.org/bin/linux), they provide information to get
  the most recent version of R for common distributions. For most distributions,
  you could use your package manager (e.g., for Debian/Ubuntu run `sudo apt-get
  install r-base`, and for Fedora `sudo yum install R`), but we don't recommend
  this approach as the versions provided by this are usually out of date. In any
  case, make sure you have at least R 3.3.1.
* Go to the [RStudio download
  page](https://www.rstudio.com/products/rstudio/download/#download)
* Under *Installers* select the version that matches your distribution, and
  install it with your preferred method (e.g., with Debian/Ubuntu `sudo dpkg -i
  rstudio-x.yy.zzz-amd64.deb` at the terminal).
* Once it's installed, open RStudio to make sure it works and you don't get any
  error messages.

These setup instructions are adapted from those written for [Data Carpentry: R
for Data Analysis and Visualization of Ecological
Data](http://www.datacarpentry.org/R-ecology-lesson/).

### Virtual environment with `renv` {#renv}

These instructions are intended to help with setting up the included [`renv`
virtual environment](https://rstudio.github.io/renv/index.html), which ensures
all participants are using the same exact set of `R` packages (and package
versions). A few important notes to keep in mind:

* When `R` is started from the top level of this repository, `renv` is
  activated automatically. There is no further action required on your part. If
  `renv` is not installed, it will be installed automatically (as long as you
  have an active internet connection).
* While `renv` is active, the `R` session will only have access to the packages
  (and their dependencies) that are listed in the `renv.lock` file -- that is,
  you should not expect to have access to any other `R` packages that may be
  installed elsewhere (e.g., a global package cache) on the computing system
  being used.
* Upon an initial attempt, `renv` will prompt you to install packages listed in
  the `renv.lock` file, by printing a message like the following:

```{r}
#| label: renv-status-example
#| eval: false
# - Project '~/git/ser2024_mediation_workshop' loaded. [renv 1.0.7]
# - One or more packages recorded in the lockfile are not installed.
# - Use `renv::status()` for more details.
```
In any such case, please call `renv::status()` to review the list of packages
missing and to view `renv`'s recommendations for fixing the issue; usually,
`renv::restore()` will be the next step necessary to install any missing
packages. Note that you **do *not* need to manually install** the packages via
`install.packages()`, `remotes::install_github()`, or similar, as `renv` will
attempt do this for you.

While unnecessary for the purposes of this workshop, if you'd like to learn
more about the details of how the `renv` virtual environment system works, the
following references may be helpful:

1. [Collaborating with
    `renv`](https://rstudio.github.io/renv/articles/collaborating.html)
2. [Introduction to `renv`](https://rstudio.github.io/renv/articles/renv.html)

In some rare cases, `R` packages that `renv` automatically tries to install as
part of the `renv::restore()` process may fail due to missing systems-level
dependencies. In such cases, a reference to the missing dependencies and
system-specific instructions their installation involving, e.g., [Ubuntu
Linux's `apt`](http://manpages.ubuntu.com/manpages/bionic/man8/apt.8.html) or
[`homebrew` for macOS](https://brew.sh/), will usually be displayed.
